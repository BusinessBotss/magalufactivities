<!DOCTYPE html>
<html lang="es" data-theme>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Magaluf Bookings</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* =========================
       Variables & Reset
       ========================= */
    :root {
      --bg-light: #ffffff;
      --text-light: #111111;
      --field-light: rgba(0,0,0,0.05);
      --border-light: rgba(0,0,0,0.2);
      --accent-light: #a100ff;

      --bg-dark: #000000;
      --text-dark: #f5f5f5;
      --field-dark: rgba(255,255,255,0.1);
      --border-dark: rgba(255,255,255,0.3);
      --accent-dark: #ff00cc;

      /* Shared */
      --radius: 8px;
      --transition: 0.3s ease;
      --shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    /* Inicializa tema seg√∫n preferencia del sistema */
    @media (prefers-color-scheme: dark) {
      :root:not([data-theme]) { --bg: var(--bg-dark); --text: var(--text-dark); --field: var(--field-dark); --border: var(--border-dark); --accent: var(--accent-dark); }
      :root:not([data-theme]) body { background: var(--bg); color: var(--text); }
    }
    @media (prefers-color-scheme: light) {
      :root:not([data-theme]) { --bg: var(--bg-light); --text: var(--text-light); --field: var(--field-light); --border: var(--border-light); --accent: var(--accent-light); }
      :root:not([data-theme]) body { background: var(--bg); color: var(--text); }
    }
    /* Override si hay atributo data-theme */
    :root[data-theme="dark"] { --bg: var(--bg-dark); --text: var(--text-dark); --field: var(--field-dark); --border: var(--border-dark); --accent: var(--accent-dark); }
    :root[data-theme="light"]{ --bg: var(--bg-light); --text: var(--text-light); --field: var(--field-light); --border: var(--border-light); --accent: var(--accent-light); }

    *, *::before, *::after { box-sizing: border-box; margin:0; padding:0; }
    html, body {
      height:100%; font-family:'Poppins',sans-serif;
      background: var(--bg); color: var(--text);
      display:flex; align-items:center; justify-content:center; padding:1rem;
    }

    /* =========================
       Contenedor principal
       ========================= */
    .container {
      width:90%; max-width:420px;
      background: var(--bg);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding:2rem;
      display:flex; flex-direction:column;
      animation: fadeInUp var(--transition) ease-out;
    }

    /* =========================
       Navegaci√≥n (Idioma & Tema)
       ========================= */
    nav {
      display:flex; justify-content:center; margin-bottom:1rem;
    }
    .lang-btn, #theme-toggle {
      background:transparent; border:none;
      color:var(--text); font-weight:600;
      margin:0 0.5rem; padding:0.25rem 0.5rem;
      border-radius:var(--radius);
      cursor:pointer; transition:background var(--transition);
    }
    .lang-btn:hover:not(.active),
    #theme-toggle:hover {
      background:var(--accent); color:var(--bg);
    }
    .lang-btn.active {
      text-decoration:underline; cursor:default;
    }
    #theme-toggle { font-size:1.2rem; }

    /* =========================
       Texto de introducci√≥n
       ========================= */
    .intro {
      text-align:center; margin-bottom:1.5rem;
      font-size:1rem; line-height:1.4;
    }

    /* =========================
       Formulario
       ========================= */
    form { display:flex; flex-direction:column; }
    .field { margin-bottom:1.2rem; position:relative; }
    label {
      display:block; margin-bottom:0.3rem;
      font-weight:600; font-size:0.95rem;
    }
    select, input, textarea {
      width:100%; padding:0.75rem 1rem;
      font-size:1rem; color:var(--text);
      background:var(--field); border:1.5px solid var(--border);
      border-radius:var(--radius);
      transition:border-color var(--transition), box-shadow var(--transition);
    }
    select {
      appearance:none;
      background-image: url("data:image/svg+xml,%3Csvg fill='%23${window.matchMedia('(prefers-color-scheme: dark)').matches? 'fff':'000'}' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:right 1rem center;
      background-size:1rem; cursor:pointer;
    }
    select:focus, input:focus, textarea:focus {
      outline:none; border-color: var(--accent);
      box-shadow: 0 0 10px var(--accent);
    }
    textarea { resize:vertical; min-height:80px; }
    .tooltip {
      position:absolute; top:100%; left:0; font-size:0.8rem;
      opacity:0.7; margin-top:0.25rem;
      pointer-events:none;
    }

    /* Spinner */
    .spinner {
      position:absolute; right:0.75rem; top:50%;
      width:20px; height:20px; transform:translateY(-50%);
      border:3px solid rgba(255,255,255,0.2);
      border-top-color:var(--text);
      border-radius:50%; animation:spin 1s linear infinite;
    }
    .hidden { display:none; }
    @keyframes spin { to { transform:rotate(360deg); } }

    /* Botones */
    .btn {
      padding:0.75rem; font-size:1rem; font-weight:600;
      border:none; border-radius:25px;
      background:transparent; color:var(--text);
      cursor:pointer; transition: background var(--transition), box-shadow var(--transition);
      margin-top:0.25rem;
    }
    .btn:disabled { opacity:0.5; cursor:not-allowed; }
    .btn:hover:not(:disabled) {
      background:var(--accent); color:var(--bg);
      box-shadow: 0 0 12px var(--accent), 0 0 24px var(--accent);
    }

    /* Footer */
    footer {
      margin-top:2rem; text-align:center;
      font-size:0.9rem; line-height:1.3; opacity:0.8;
    }
    footer a { color:var(--accent); text-decoration:none; font-weight:600; }
    footer a:hover { text-decoration:underline; }

    /* Estado */
    #status-msg { margin-top:1rem; text-align:center; font-weight:600; min-height:1.2em; color:var(--accent); }

    /* Animaci√≥n */
    @keyframes fadeInUp {
      from { opacity:0; transform:translateY(20px); }
      to   { opacity:1; transform:translateY(0); }
    }
  </style>
</head>
<body>
  <div class="container">
    <nav id="lang-switch" aria-label="Language switcher"></nav>
    <button id="theme-toggle" aria-label="Toggle theme">üåô</button>
    <p class="intro" id="intro-text" tabindex="0"></p>

    <form id="booking-form" novalidate>
      <div class="field">
        <label for="time-category" id="label-time"></label>
        <select id="time-category" required></select>
        <div id="spinner" class="spinner hidden" aria-hidden="true"></div>
      </div>
      <div class="field">
        <label for="activity" id="label-activity"></label>
        <select id="activity" required></select>
      </div>
      <div class="field">
        <label for="participants" id="label-participants"></label>
        <input type="number" id="participants" min="1" max="20" value="1" required aria-describedby="tip-participants" data-tooltip="Max 20 participants" />
        <span class="tooltip" id="tip-participants"></span>
      </div>
      <div class="field">
        <label for="phone" id="label-phone"></label>
        <input type="tel" id="phone" placeholder="+34 600 000 000" pattern="^\\+34\\s?\\d{9}$" required aria-describedby="tip-phone" data-tooltip="Format: +34 600000000" />
        <span class="tooltip" id="tip-phone"></span>
      </div>
      <div class="field">
        <label for="notes" id="label-notes"></label>
        <textarea id="notes"></textarea>
      </div>

      <button type="button" id="save-fav" class="btn" disabled></button>
      <button type="submit" id="submit-btn" class="btn" disabled></button>
      <p id="status-msg" role="alert" aria-live="polite"></p>
    </form>

    <footer>
      <p id="help-text"></p>
      <p id="disclaimer-text"></p>
    </footer>
  </div>

  <script>
  (() => {
    const whatsappNumber = "34644075065";
    const translations = {
      EN: {
        intro: "Book your favorite activities in Magaluf hassle-free.",
        labels: { time:"Time of Day", activity:"Select Activity", participants:"Number of Participants", phone:"Phone Number", notes:"Additional Notes (optional)" },
        placeholders:{ time:"-- Choose Time --", activity:"-- Choose Activity --" },
        activities:{ day:["Oceans Beach Club Tickets","Jetski Rental","Boat Party","Boat Rentals","Quad Rental"], night:["Pirates Adventure","Gringo's Bingo","MCP Pass"] },
        submit:"Book via WhatsApp", saveFav:"Save Favorite",
        help:"Need help? Chat with us ‚Üí", disclaimer:"Reservations pending until confirmed via WhatsApp."
      },
      ES: {
        intro: "Reserva tus actividades favoritas en Magaluf de forma r√°pida y sencilla.",
        labels: { time:"Momento del D√≠a", activity:"Selecciona Actividad", participants:"N√∫mero de Participantes", phone:"N√∫mero de Tel√©fono", notes:"Notas Adicionales (opcional)" },
        placeholders:{ time:"-- Elige Momento --", activity:"-- Elige Actividad --" },
        activities:{ day:["Entradas Oceans Beach Club","Alquiler de Jetski","Fiesta en Barco","Alquiler de Barco","Alquiler de Quad"], night:["Pirates Adventure","Bingo de Gringo's","MCP Pass"] },
        submit:"Reservar por WhatsApp", saveFav:"Guardar Favorito",
        help:"¬øNecesitas ayuda? Habla con nosotros ‚Üí", disclaimer:"Reservas pendientes hasta confirmaci√≥n por WhatsApp."
      },
      FR: {
        intro: "R√©servez vos activit√©s pr√©f√©r√©es √† Magaluf en toute simplicit√©.",
        labels: { time:"Moment de la Journ√©e", activity:"Choisir une Activit√©", participants:"Nombre de Participants", phone:"Num√©ro de T√©l√©phone", notes:"Notes Suppl√©mentaires (facultatif)" },
        placeholders:{ time:"-- Choisir Moment --", activity:"-- Choisir Activit√© --" },
        activities:{ day:["Billets Oceans Beach Club","Location de Jetski","F√™te en Bateau","Location de Bateau","Location de Quad"], night:["Pirates Adventure","Bingo de Gringo's","Pass MCP"] },
        submit:"R√©server via WhatsApp", saveFav:"Enregistrer Favori",
        help:"Besoin d'aide ? Parlez √† nous ‚Üí", disclaimer:"R√©servations en attente jusqu'√† confirmation via WhatsApp."
      },
      DE: {
        intro: "Buche deine Lieblingsaktivit√§ten in Magaluf ganz einfach.",
        labels: { time:"Tageszeit", activity:"Aktivit√§t w√§hlen", participants:"Teilnehmerzahl", phone:"Telefonnummer", notes:"Zus√§tzliche Notizen (optional)" },
        placeholders:{ time:"-- W√§hle Zeit --", activity:"-- W√§hle Aktivit√§t --" },
        activities:{ day:["Oceans Beach Club Tickets","Jetski Verleih","Bootsparty","Bootsverleih","Quad Verleih"], night:["Pirates Adventure","Gringo's Bingo","MCP Pass"] },
        submit:"Per WhatsApp buchen", saveFav:"Favorit speichern",
        help:"Brauchen Sie Hilfe? Sprechen Sie mit uns ‚Üí", disclaimer:"Reservierungen ausstehend bis Best√§tigung via WhatsApp."
      },
      IT: {
        intro: "Prenota le tue attivit√† preferite a Magaluf in modo semplice.",
        labels: { time:"Momento del Giorno", activity:"Seleziona Attivit√†", participants:"Numero di Partecipanti", phone:"Numero di Telefono", notes:"Note Aggiuntive (opzionale)" },
        placeholders:{ time:"-- Scegli Momento --", activity:"-- Scegli Attivit√† --" },
        activities:{ day:["Biglietti Oceans Beach Club","Noleggio Jetski","Festa in Barca","Noleggio Barca","Noleggio Quad"], night:["Pirates Adventure","Bingo di Gringo's","MCP Pass"] },
        submit:"Prenota via WhatsApp", saveFav:"Salva Preferito",
        help:"Hai bisogno d'aiuto? Parla con noi ‚Üí", disclaimer:"Prenotazioni in attesa fino a conferma via WhatsApp."
      }
    };

    // Elementos
    const el = {
      langSwitch: document.getElementById("lang-switch"),
      themeToggle: document.getElementById("theme-toggle"),
      intro: document.getElementById("intro-text"),
      labels: {
        time: document.getElementById("label-time"),
        activity: document.getElementById("label-activity"),
        participants: document.getElementById("label-participants"),
        phone: document.getElementById("label-phone"),
        notes: document.getElementById("label-notes")
      },
      selects: {
        time: document.getElementById("time-category"),
        activity: document.getElementById("activity")
      },
      spinner: document.getElementById("spinner"),
      participants: document.getElementById("participants"),
      tipParticipants: document.getElementById("tip-participants"),
      phone: document.getElementById("phone"),
      tipPhone: document.getElementById("tip-phone"),
      saveFav: document.getElementById("save-fav"),
      submitBtn: document.getElementById("submit-btn"),
      statusMsg: document.getElementById("status-msg"),
      help: document.getElementById("help-text"),
      disclaimer: document.getElementById("disclaimer-text"),
      form: document.getElementById("booking-form")
    };

    let currentLang = localStorage.getItem("lang") || "EN";
    let fav = JSON.parse(localStorage.getItem("fav") || "null");

    const init = () => {
      renderLangButtons();
      setLanguage(currentLang);
      applyTheme(localStorage.getItem("theme") || null);
      el.selects.time.addEventListener("change", renderActivities);
      el.form.addEventListener("input", validateForm);
      el.form.addEventListener("submit", onSubmit);
      el.saveFav.addEventListener("click", saveFavorite);
      el.participants.addEventListener("focus", () => el.tipParticipants.textContent = el.participants.dataset.tooltip);
      el.participants.addEventListener("blur", () => el.tipParticipants.textContent = "");
      el.phone.addEventListener("focus", () => el.tipPhone.textContent = el.phone.dataset.tooltip);
      el.phone.addEventListener("blur", () => el.tipPhone.textContent = "");
      el.phone.addEventListener("input", validatePhone);
      el.themeToggle.addEventListener("click", toggleTheme);
      if (fav) loadFavorite();
    };

    function renderLangButtons() {
      el.langSwitch.innerHTML = "";
      Object.keys(translations).forEach(code => {
        const btn = document.createElement("button");
        btn.type = "button"; btn.textContent = code; btn.className = "lang-btn";
        btn.addEventListener("click", () => setLanguage(code));
        el.langSwitch.appendChild(btn);
      });
    }

    function setLanguage(lang) {
      currentLang = lang; localStorage.setItem("lang", lang);
      applyLanguage(lang);
    }

    function applyLanguage(lang) {
      const t = translations[lang];
      document.querySelectorAll(".lang-btn").forEach(b => b.classList.toggle("active", b.textContent === lang));
      el.intro.textContent = t.intro;
      el.help.innerHTML = `<a href="https://wa.me/${whatsappNumber}" target="_blank" rel="noopener">${t.help}</a>`;
      el.disclaimer.textContent = t.disclaimer;
      ["time","activity","participants","phone","notes"].forEach(key => {
        el.labels[key].textContent = t.labels[key];
      });
      renderSelectOptions(el.selects.time, t.placeholders.time, Object.keys(t.activities));
      renderActivities();
      el.submitBtn.textContent = t.submit;
      el.saveFav.textContent = t.saveFav;
      validateForm();
    }

    function renderSelectOptions(selectEl, placeholder, opts) {
      selectEl.innerHTML = `<option value="" disabled selected>${placeholder}</option>`;
      opts.forEach(o => {
        const opt = document.createElement("option");
        opt.value = o; opt.textContent = o;
        selectEl.appendChild(opt);
      });
    }

    function renderActivities() {
      el.spinner.classList.remove("hidden");
      setTimeout(() => {
        const t = translations[currentLang];
        const key = el.selects.time.value;
        renderSelectOptions(el.selects.activity, t.placeholders.activity, t.activities[key]||[]);
        el.spinner.classList.add("hidden");
        validateForm();
      }, 300);
    }

    function validatePhone() {
      const pat = /^\+34\s?\d{9}$/;
      if (!pat.test(el.phone.value.trim())) {
        el.phone.setCustomValidity("Formato: +34 600000000");
      } else {
        el.phone.setCustomValidity("");
      }
    }

    function validateForm() {
      validatePhone();
      const valid = el.selects.time.value && el.selects.activity.value &&
                    el.participants.checkValidity() && el.phone.checkValidity();
      el.submitBtn.disabled = !valid;
      el.saveFav.disabled = !valid;
    }

    function onSubmit(e) {
      e.preventDefault();
      el.statusMsg.textContent = "‚è≥ " + translations[currentLang].submit + "...";
      const text =
        `${translations[currentLang].submit}:\n` +
        `‚Ä¢ ${el.selects.activity.value} (${el.selects.time.selectedOptions[0].text})\n` +
        `‚Ä¢ Participants: ${el.participants.value}\n` +
        `‚Ä¢ Phone: ${el.phone.value}\n` +
        `‚Ä¢ Notes: ${el.notes.value.trim()||"-"}`;
      window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(text)}`, "_blank");
      setTimeout(() => el.statusMsg.textContent = "‚úÖ " + translations[currentLang].submit + "!", 800);
    }

    function toggleTheme() {
      const saved = localStorage.getItem("theme");
      const next = saved==="dark" ? "light" : "dark";
      applyTheme(next);
    }

    function applyTheme(pref) {
      if (pref) {
        document.documentElement.setAttribute("data-theme", pref);
      } else {
        document.documentElement.removeAttribute("data-theme");
      }
      localStorage.setItem("theme", document.documentElement.getAttribute("data-theme")||"");
      el.themeToggle.textContent = document.documentElement.getAttribute("data-theme")==="light" ? "‚òÄÔ∏è" : "üåô";
    }

    function saveFavorite() {
      fav = {
        time: el.selects.time.value,
        activity: el.selects.activity.value,
        participants: el.participants.value,
        phone: el.phone.value,
        notes: el.notes.value.trim()
      };
      localStorage.setItem("fav", JSON.stringify(fav));
      el.statusMsg.textContent = "‚≠ê " + translations[currentLang].saveFav + "!";
    }

    function loadFavorite() {
      el.selects.time.value = fav.time;
      renderActivities();
      setTimeout(() => {
        el.selects.activity.value = fav.activity;
        el.participants.value = fav.participants;
        el.phone.value = fav.phone;
        el.notes.value = fav.notes;
        validateForm();
      }, 350);
    }

    document.addEventListener("DOMContentLoaded", init);
  })();
  </script>
</body>
</html>